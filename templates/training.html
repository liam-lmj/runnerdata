{% extends "layout.html" %}

{% block title %}
    Training Plans
{% endblock %}

{% block body %}
    <h1>Training Plans</h1>

    <select id="trainingPlanSelection" name="trainingPlanSelection">
            <option value="Current">Current</option>
            <option value="Previous">Previous</option>  
            <option value="All">All</option>
    </select>

    <table id="trainingTable" class="card-table">
    </table> 

    <script>
        const trainingPlans = {{ training_plans | tojson }};
        const currentWeekYear = "{{ current_week }}";
        const daysOfWeek = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];
        const table = document.getElementById("trainingTable");
        const selection = document.getElementById("trainingPlanSelection");

        function renderTable() {
            const currentSelection = selection.value;

                table.innerHTML = "";

                const filteredPlans = trainingPlans.filter(plan => {
                    if (currentSelection === "All") return true; 
                    const weekYear = plan.week;
                    const [week, year] = weekYear.split("-").map(Number);
                    const [currentWeek, currentYear] = currentWeekYear.split("-").map(Number);
                    const yearDiff = year - currentYear;
                    const weekDiff = week - currentWeek;

                    let current;

                    if (yearDiff > 0 || (yearDiff === 0 && weekDiff >= 0))
                    {
                        current = true;
                    }
                    else 
                    {
                        current = false;
                    }

                    if (currentSelection === "Current" && current){
                        return true
                    } 
                    if (currentSelection === "Previous" && !current){
                        return true
                    } 
                    return false;    
                });
                
                filteredPlans.forEach(plan => {
                    const week = plan.week 
                    let orderedPlan = {};
                    for (const key of daysOfWeek)
                    {
                        orderedPlan[key] = plan[key];
                    }

                    let row = "<tr><th>" + week + "</th>";

                    for (const [key, value] of Object.entries(orderedPlan)) {
                        if (key != "week") {
                            const day = key.charAt(0).toUpperCase() + key.slice(1);
                            row += "<td>";
                            row += "<div class='center-text'>" + day + "</div>";
                            row += "Easy distance: " + value["easy_distance"] + "<br>";
                            row += "Hard distance: " + value["hard_distance"] + "<br>";
                            row += "Total distance: " + (parseFloat(value["hard_distance"]) + parseFloat(value["easy_distance"])) + "<br>";
                            row += "</td>"
                        }
                    }
                    row += "</tr>"

                    table.innerHTML += row;
            });
        }

        renderTable();

        selection.addEventListener("change", renderTable);
    </script>

{% endblock %}